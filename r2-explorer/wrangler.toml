name = "r2-explorer"
main = "src/index.ts"
compatibility_date = "2026-02-06"
routes = [
  { pattern = "files.unsigned.sh/api/v2/*", zone_name = "unsigned.sh" },
  { pattern = "files.unsigned.sh/share/*", zone_name = "unsigned.sh" },
]

[vars]
R2E_MAX_SHARE_TTL_SEC = "2592000"
R2E_DEFAULT_SHARE_TTL_SEC = "86400"
R2E_UI_MAX_LIST_LIMIT = "1000"
R2E_READONLY = "false"
# Optional. If omitted, Worker derives base URL from the request.
R2E_PUBLIC_BASE_URL = ""
# Optional. JSON map of bucket alias -> binding name (must include {"files":"FILES_BUCKET"}).
R2E_BUCKET_MAP = ""
# Required for strict OAuth JWT verification on /api/v2/* routes.
R2E_IDP_ISSUER = "replace-with-idp-issuer"
# Required audience claim for /api/v2/* routes.
R2E_IDP_AUDIENCE = "replace-with-idp-audience"
# Optional. Defaults to "${R2E_IDP_ISSUER}/jwks".
R2E_IDP_JWKS_URL = "replace-with-idp-jwks-url"
R2E_IDP_REQUIRED_SCOPES_READ = "replace-with-idp-required-scopes-read"
R2E_IDP_REQUIRED_SCOPES_WRITE = "replace-with-idp-required-scopes-write"
R2E_IDP_REQUIRED_SCOPES_SHARE_MANAGE = "replace-with-idp-required-scopes-share-manage"
R2E_IDP_CLOCK_SKEW_SEC = "replace-with-idp-clock-skew-sec"
R2E_IDP_JWKS_CACHE_TTL_SEC = "replace-with-idp-jwks-cache-ttl-sec"
# Browser OAuth login/callback config for cookie-backed web sessions.
R2E_WEB_OAUTH_AUTHORIZE_URL = "replace-with-web-oauth-authorize-url"
R2E_WEB_OAUTH_TOKEN_URL = "replace-with-web-oauth-token-url"
R2E_WEB_OAUTH_CLIENT_ID = "replace-with-web-oauth-client-id"
R2E_WEB_OAUTH_SCOPE = "replace-with-web-oauth-scope"
R2E_WEB_OAUTH_RESOURCE = "replace-with-web-oauth-resource"
# Optional. Defaults to "<public-base-or-request-origin>/api/v2/auth/callback".
R2E_WEB_OAUTH_REDIRECT_URI = ""
R2E_WEB_COOKIE_NAME = "r2e_session"
R2E_WEB_COOKIE_MAX_AGE_SEC = "3600"
# Upload policy defaults. Set to "0" for unlimited where applicable.
R2E_UPLOAD_MAX_FILE_BYTES = "0"
R2E_UPLOAD_MAX_PARTS = "0"
R2E_UPLOAD_MAX_CONCURRENT_PER_USER = "0"
R2E_UPLOAD_SESSION_TTL_SEC = "3600"
R2E_UPLOAD_SIGN_TTL_SEC = "60"
R2E_UPLOAD_PART_SIZE_BYTES = "8388608"
R2E_UPLOAD_ALLOWED_MIME = ""
R2E_UPLOAD_BLOCKED_MIME = ""
R2E_UPLOAD_ALLOWED_EXT = ""
R2E_UPLOAD_BLOCKED_EXT = ""
R2E_UPLOAD_PREFIX_ALLOWLIST = ""
R2E_UPLOAD_ALLOWED_ORIGINS = ""
R2E_UPLOAD_S3_BUCKET = "replace-with-upload-s3-bucket"

[[r2_buckets]]
binding = "FILES_BUCKET"
bucket_name = "replace-with-r2-bucket"
preview_bucket_name = "replace-with-r2-bucket-preview"

[[kv_namespaces]]
binding = "R2E_SHARES_KV"
id = "replace-with-shares-kv-namespace-id"
preview_id = "replace-with-shares-kv-namespace-id-preview"

[[durable_objects.bindings]]
name = "R2E_UPLOAD_SESSIONS"
class_name = "UploadSessionDurableObject"

[[migrations]]
tag = "r2e-upload-sessions-v1"
new_sqlite_classes = ["UploadSessionDurableObject"]

[env.preview]
workers_dev = true

[[env.preview.routes]]
pattern = "preview.files.unsigned.sh"
custom_domain = true

[[env.preview.routes]]
pattern = "preview.files.unsigned.sh/api/v2/*"
zone_name = "unsigned.sh"

[[env.preview.routes]]
pattern = "preview.files.unsigned.sh/share/*"
zone_name = "unsigned.sh"

[env.preview.vars]
R2E_MAX_SHARE_TTL_SEC = "2592000"
R2E_DEFAULT_SHARE_TTL_SEC = "86400"
R2E_UI_MAX_LIST_LIMIT = "1000"
R2E_READONLY = "false"
# Optional. If omitted, Worker derives base URL from the request.
R2E_PUBLIC_BASE_URL = ""
# Optional. JSON map of bucket alias -> binding name (must include {"files":"FILES_BUCKET"}).
R2E_BUCKET_MAP = ""
# Required for strict OAuth JWT verification on /api/v2/* routes.
R2E_IDP_ISSUER = "replace-with-idp-issuer-preview"
# Required audience claim for /api/v2/* routes.
R2E_IDP_AUDIENCE = "replace-with-idp-audience-preview"
# Optional. Defaults to "${R2E_IDP_ISSUER}/jwks".
R2E_IDP_JWKS_URL = "replace-with-idp-jwks-url-preview"
R2E_IDP_REQUIRED_SCOPES_READ = "replace-with-idp-required-scopes-read-preview"
R2E_IDP_REQUIRED_SCOPES_WRITE = "replace-with-idp-required-scopes-write-preview"
R2E_IDP_REQUIRED_SCOPES_SHARE_MANAGE = "replace-with-idp-required-scopes-share-manage-preview"
R2E_IDP_CLOCK_SKEW_SEC = "replace-with-idp-clock-skew-sec-preview"
R2E_IDP_JWKS_CACHE_TTL_SEC = "replace-with-idp-jwks-cache-ttl-sec-preview"
R2E_WEB_OAUTH_AUTHORIZE_URL = "replace-with-web-oauth-authorize-url-preview"
R2E_WEB_OAUTH_TOKEN_URL = "replace-with-web-oauth-token-url-preview"
R2E_WEB_OAUTH_CLIENT_ID = "replace-with-web-oauth-client-id-preview"
R2E_WEB_OAUTH_SCOPE = "replace-with-web-oauth-scope-preview"
R2E_WEB_OAUTH_RESOURCE = "replace-with-web-oauth-resource-preview"
R2E_WEB_OAUTH_REDIRECT_URI = ""
R2E_WEB_COOKIE_NAME = "r2e_session"
R2E_WEB_COOKIE_MAX_AGE_SEC = "3600"
R2E_UPLOAD_MAX_FILE_BYTES = "0"
R2E_UPLOAD_MAX_PARTS = "0"
R2E_UPLOAD_MAX_CONCURRENT_PER_USER = "0"
R2E_UPLOAD_SESSION_TTL_SEC = "3600"
R2E_UPLOAD_SIGN_TTL_SEC = "60"
R2E_UPLOAD_PART_SIZE_BYTES = "8388608"
R2E_UPLOAD_ALLOWED_MIME = ""
R2E_UPLOAD_BLOCKED_MIME = ""
R2E_UPLOAD_ALLOWED_EXT = ""
R2E_UPLOAD_BLOCKED_EXT = ""
R2E_UPLOAD_PREFIX_ALLOWLIST = ""
R2E_UPLOAD_ALLOWED_ORIGINS = ""
R2E_UPLOAD_S3_BUCKET = "replace-with-upload-s3-bucket-preview"

[[env.preview.r2_buckets]]
binding = "FILES_BUCKET"
bucket_name = "replace-with-r2-bucket-preview"

[[env.preview.kv_namespaces]]
binding = "R2E_SHARES_KV"
id = "replace-with-shares-kv-namespace-id-preview"

[[env.preview.durable_objects.bindings]]
name = "R2E_UPLOAD_SESSIONS"
class_name = "UploadSessionDurableObject"
