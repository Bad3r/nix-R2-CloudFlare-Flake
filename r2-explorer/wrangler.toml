name = "r2-explorer"
main = "src/index.ts"
compatibility_date = "2026-02-06"
routes = [
  { pattern = "files.unsigned.sh/api/v2/*", zone_name = "unsigned.sh" },
  { pattern = "files.unsigned.sh/share/*", zone_name = "unsigned.sh" },
]

[vars]
R2E_MAX_SHARE_TTL_SEC = "2592000"
R2E_DEFAULT_SHARE_TTL_SEC = "86400"
R2E_UI_MAX_LIST_LIMIT = "1000"
R2E_READONLY = "false"
# Optional. If omitted, Worker derives base URL from the request.
R2E_PUBLIC_BASE_URL = ""
# Optional. JSON map of bucket alias -> binding name (must include {"files":"FILES_BUCKET"}).
R2E_BUCKET_MAP = ""
# Required for strict OAuth JWT verification on /api/v2/* routes.
R2E_AUTH_ISSUER = "replace-with-auth-issuer"
# Required audience claim for /api/v2/* routes.
R2E_AUTH_AUDIENCE = "replace-with-auth-audience"
# Optional. Defaults to "${R2E_AUTH_ISSUER}/jwks".
R2E_AUTH_JWKS_URL = "replace-with-auth-jwks-url"
R2E_AUTH_SCOPE_READ = "r2.read"
R2E_AUTH_SCOPE_WRITE = "r2.write"
R2E_AUTH_SCOPE_SHARE_MANAGE = "r2.share.manage"
# Upload policy defaults. Set to "0" for unlimited where applicable.
R2E_UPLOAD_MAX_FILE_BYTES = "0"
R2E_UPLOAD_MAX_PARTS = "0"
R2E_UPLOAD_MAX_CONCURRENT_PER_USER = "0"
R2E_UPLOAD_SESSION_TTL_SEC = "3600"
R2E_UPLOAD_SIGN_TTL_SEC = "60"
R2E_UPLOAD_PART_SIZE_BYTES = "8388608"
R2E_UPLOAD_ALLOWED_MIME = ""
R2E_UPLOAD_BLOCKED_MIME = ""
R2E_UPLOAD_ALLOWED_EXT = ""
R2E_UPLOAD_BLOCKED_EXT = ""
R2E_UPLOAD_PREFIX_ALLOWLIST = ""
R2E_UPLOAD_ALLOWED_ORIGINS = ""
R2E_UPLOAD_S3_BUCKET = "replace-with-upload-s3-bucket"

[[r2_buckets]]
binding = "FILES_BUCKET"
bucket_name = "replace-with-r2-bucket"
preview_bucket_name = "replace-with-r2-bucket-preview"

[[kv_namespaces]]
binding = "R2E_SHARES_KV"
id = "replace-with-shares-kv-namespace-id"
preview_id = "replace-with-shares-kv-namespace-id-preview"

[[durable_objects.bindings]]
name = "R2E_UPLOAD_SESSIONS"
class_name = "UploadSessionDurableObject"

[[migrations]]
tag = "r2e-upload-sessions-v1"
new_sqlite_classes = ["UploadSessionDurableObject"]

[env.preview]
workers_dev = true
# Prevent preview from inheriting production zone routes.
routes = [
  { pattern = "preview.files.unsigned.sh", custom_domain = true },
  { pattern = "preview.files.unsigned.sh/api/v2/*", zone_name = "unsigned.sh" },
  { pattern = "preview.files.unsigned.sh/share/*", zone_name = "unsigned.sh" },
]

[env.preview.vars]
R2E_MAX_SHARE_TTL_SEC = "2592000"
R2E_DEFAULT_SHARE_TTL_SEC = "86400"
R2E_UI_MAX_LIST_LIMIT = "1000"
R2E_READONLY = "false"
# Optional. If omitted, Worker derives base URL from the request.
R2E_PUBLIC_BASE_URL = ""
# Optional. JSON map of bucket alias -> binding name (must include {"files":"FILES_BUCKET"}).
R2E_BUCKET_MAP = ""
# Required for strict OAuth JWT verification on /api/v2/* routes.
R2E_AUTH_ISSUER = "replace-with-auth-issuer-preview"
# Required audience claim for /api/v2/* routes.
R2E_AUTH_AUDIENCE = "replace-with-auth-audience-preview"
# Optional. Defaults to "${R2E_AUTH_ISSUER}/jwks".
R2E_AUTH_JWKS_URL = "replace-with-auth-jwks-url-preview"
R2E_AUTH_SCOPE_READ = "r2.read"
R2E_AUTH_SCOPE_WRITE = "r2.write"
R2E_AUTH_SCOPE_SHARE_MANAGE = "r2.share.manage"
R2E_UPLOAD_MAX_FILE_BYTES = "0"
R2E_UPLOAD_MAX_PARTS = "0"
R2E_UPLOAD_MAX_CONCURRENT_PER_USER = "0"
R2E_UPLOAD_SESSION_TTL_SEC = "3600"
R2E_UPLOAD_SIGN_TTL_SEC = "60"
R2E_UPLOAD_PART_SIZE_BYTES = "8388608"
R2E_UPLOAD_ALLOWED_MIME = ""
R2E_UPLOAD_BLOCKED_MIME = ""
R2E_UPLOAD_ALLOWED_EXT = ""
R2E_UPLOAD_BLOCKED_EXT = ""
R2E_UPLOAD_PREFIX_ALLOWLIST = ""
R2E_UPLOAD_ALLOWED_ORIGINS = ""
R2E_UPLOAD_S3_BUCKET = "replace-with-upload-s3-bucket-preview"

[[env.preview.r2_buckets]]
binding = "FILES_BUCKET"
bucket_name = "replace-with-r2-bucket-preview"

[[env.preview.kv_namespaces]]
binding = "R2E_SHARES_KV"
id = "replace-with-shares-kv-namespace-id-preview"

[[env.preview.durable_objects.bindings]]
name = "R2E_UPLOAD_SESSIONS"
class_name = "UploadSessionDurableObject"
